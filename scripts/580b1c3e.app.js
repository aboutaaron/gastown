var Gastown=Gastown||{},s;Gastown={config:{defaultZoomLevel:16,map:new L.Map("map",{center:new L.LatLng(49.261226,-123.113927),zoom:12,scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,zoomControl:!1}),data:0,helpers:Handlebars.registerHelper("percentage",function(a,b){"use strict";return(100*(a/b)).toFixed(1)}),csv:"data/2013-06-03-rental-standards.csv",cluster:new L.MarkerClusterGroup({showCoverageOnHover:!1,disableClusteringAtZoom:17})},init:function(){"use strict";s=this.config,this.createMap(),this.extractCSV(s.csv)},createMap:function(){"use strict";var a=new L.StamenTileLayer("toner"),b=new L.Control.Zoom({position:"topright"}),c=new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.Google,country:"Canada",zoomLevel:s.defaultZoomLevel}),d=new L.MarkerClusterGroup({showCoverageOnHover:!1,disableClusteringAtZoom:s.defaultZoomLevel});s.map.addLayer(a),b.addTo(s.map),c.addTo(s.map),d.addTo(s.map)},extractCSV:function(a){"use strict";var b=new Miso.Dataset({url:a,delimiter:","});b.fetch({error:function(a){console.log(a)},success:function(){s.data=this,Gastown.addMarkerToCluster(s.data)}})},buildTemplate:function(a){"use strict";var b=$("#rental-details-template").html(),c=Handlebars.compile(b);$("#rental-details").html(c(a))},addMarkerToCluster:function(a){"use strict";a.each(function(a){var b=new L.marker([a.LAT,a.LNG]);s.cluster.addLayer(b),b.on("click",function(){Gastown.buildTemplate(a)})}),s.map.addLayer(s.cluster)}},jQuery(document).ready(function(){"use strict";Gastown.init()});